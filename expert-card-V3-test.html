<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>業務金牌調整版</title>
    <!-- <script src="https://cdn.jsdelivr.net/gh/dajuteam/daju-custom@v1.1.6/expert-card-widget.js"></script> -->

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css" />
    <link href="https://fonts.googleapis.com/css2?family=Shrikhand&display=swap" rel="stylesheet" />
    <style>
        *{
            box-sizing: border-box;
        }
        /* 金牌業務卡片的CSS */

        /* 隱藏狀態 - 完全隱藏，不佔據空間 */
        .expert-card-hidden {
            opacity: 0 !important;
            visibility: hidden !important;
            transform: scale(0.8) !important;
            transition: none !important;
            pointer-events: none !important;
        }


        .expert-card-fallback {
            opacity: 1 !important;
            visibility: visible !important;
            transform: scale(1) translateY(0) !important;
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1) !important;
        }

        .expert-card-wrapper {
            position: relative;
            padding: 3px;
            border-radius: 10px;
            overflow: hidden;
            width: 100%;
            max-width: 1000px;
            background: #fff;
            z-index: 0;
            line-height: 1.5;
            letter-spacing: 0px;
            margin: 20px 0;
            margin-bottom: 60px;
        }

        .expert-card-wrapper::before {
            content: "";
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            border-radius: 0;
            background: linear-gradient(130deg, #fff6d5, #a6813b, #ffe8b7, #a57d1f, #ffedb1, #b38b40, #e7c57c);
            background-size: 400% 400%;
            animation: borderFlow 10s linear infinite;
            z-index: -2;
            box-shadow: 0 0 5px rgba(106, 70, 19, 0.715);
        }




        @keyframes borderFlow {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        .expert-card {
            border-radius: 10px;
            padding: 10px 22px;
            position: relative;
            display: flex;
            align-items: center;
            flex-wrap: wrap;

        }

        .expert-pin {
            width: 6px;
            height: 6px;
            background: #c1a75a;
            border-radius: 50%;
            position: absolute;
        }

        .expert-pin-tl {
            top: 12px;
            left: 12px;
        }

        .expert-pin-tr {
            top: 12px;
            right: 12px;
        }

        .expert-pin-bl {
            bottom: 12px;
            left: 12px;
        }

        .expert-pin-br {
            bottom: 12px;
            right: 12px;
        }

        .expert-badge {
            display: none;
        }

        .expert-platinum .expert-badge {
            background: radial-gradient(circle, #f5d770, #d1a106);
        }

        .expert-badge i {
            color: #fff;
            font-size: 1.8em;
        }

        @keyframes rotateBadge {
            0% {
                transform: rotateY(0deg);
            }

            100% {
                transform: rotateY(360deg);
            }
        }

        .expert-profile {
            width: 80px !important;
            height: 80px !important;
            border-radius: 12px;
            border: 4px solid white;
            object-fit: cover;
            margin-right: 15px !important;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .expert-info {
            flex: 1;
        }

        .expert-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 6px;
        }

        .expert-platinum .expert-title {
            color: #9f5f00;
        }

        .expert-name-row {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 16px;
            margin-bottom: 10px;
            position: relative;
            z-index: 10;
        }

        .expert-name {
            font-size: 1.6rem;
            font-weight: bold;
        }

        .expert-contact-phone {
            background: linear-gradient(to right, #a45500, #ff9e36);
        }

        .expert-contact-line {
            background: linear-gradient(to right, #00a816, #67ca04);
        }

        .expert-contact {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .expert-contact a {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 10px;
            border-radius: 50%;
            font-weight: bold;
            font-size: 1.1em;
            text-decoration: none;
            transition: all 0.2s ease;
        }

        .expert-platinum {
            /* background-image: url("images/test3.jpg"); */
            background-size: cover;

            background: linear-gradient(135deg, #F2E3B3, #D9C49C, #ffe0c3, #ffe9d7);
            box-shadow: 0 0 5px #b78009;
        }



        /* 覆蓋樣式用 */


        .expert-card-wrapper.expert-style-a .expert-card {
            background: linear-gradient(135deg, #fff7cd, #ffefbb, #fff7cd, #ffe89c);

        }

        .expert-card-wrapper.expert-style-b .expert-card {
            background: linear-gradient(120deg, rgb(255, 227, 126) 5%, #ffe68d 10%, #fff8d2 20%, #fff8d2 30%, #fffbec 35%, #ffe68d 60%, #fff7e0 85%, #fcd36c 100%);

        }

        .expert-card-wrapper.expert-style-c .expert-card {
            background: linear-gradient(120deg, rgb(255, 227, 126) 5%, #ffe68d 10%, #fff8d2 20%, #fff8d2 30%, #fffbec 35%, #ffe68d 60%, #fff7e0 85%, #fcd36c 100%);

        }

        .expert-card-wrapper.expert-style-d .expert-card {
            background: linear-gradient(125deg, rgba(168, 140, 114, 1) 0%, rgba(215, 192, 166, 1) 17%, rgba(247, 233, 218, 1) 31%, rgba(215, 194, 173, 1) 44%, rgba(181, 155, 130, 1) 59%, rgba(168, 140, 114, 1) 70%, rgba(207, 178, 149, 1) 81%, rgba(168, 140, 114, 1) 88%);
        }


        .expert-card-wrapper.expert-style-c {
            padding: 0 !important;
        }

        .expert-card-wrapper.expert-style-d {
            padding: 0 !important;
        }

        /* 覆蓋樣式用 */

        .expert-platinum .expert-contact a {
            color: #fff;
        }

        .expert-footer {
            font-size: 0.45rem;
            color: #af885c;
        }

        .expert-level-mark {
            position: absolute;
            right: 18px;
            top: 10px;
            font-family: "Shrikhand", serif;
            font-style: italic;
            font-size: 1.1rem;
            color: rgba(196, 155, 90, 0.5);
            opacity: 0;
            animation: fadeSlideIn 0.8s ease-out forwards;
            animation-delay: 1s;
            pointer-events: none;
            z-index: 2;
        }

        @keyframes fadeSlideIn {
            0% {
                transform: translate(0, 20px);
                opacity: 0;
            }

            100% {
                transform: translate(0, 0);
                opacity: 0.9;
            }
        }

        .expert-contact a span {
            display: none;
        }


        .expert-title i {
            animation: rotateBadge 3s linear infinite;

        }

        .expert-opacity-0 {
            opacity: 0;
            pointer-events: none;
            visibility: hidden;
            transition: opacity 0.2s ease;
        }





        @media screen and (min-width: 992px) {
              .expert-card-wrapper {
            position: relative;
            padding: 6px;
            border-radius: 15px;
            overflow: hidden;
            width: 100%;
            max-width: 1000px;
            background: #fff;
            z-index: 0;
            line-height: 1.5;
            letter-spacing: 0px;
            margin: 20px 0;
            margin-bottom: 60px;
        }

        
    .expert-card-wrapper::before {

            box-shadow: 0 0 16px rgba(106, 70, 19, 0.715);
        }
       
            .expert-card {
                 border-radius: 15px;
                padding: 28px;
            }

            .expert-pin {
                width: 10px;
                height: 10px;
            }

            .expert-title {
                font-size: 1.7rem;
            }

            .expert-title i {
                animation: normal;

            }




            .expert-contact a {
                font-size: 1.4rem;
                padding: 10px 20px;
                border-radius: 10px;
                letter-spacing: 1.1px;
            }

            .expert-contact a span {
                display: inline;
            }

            .expert-badge {
                width: 60px;
                height: 60px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                margin-right: 25px;
                flex-shrink: 0;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
                animation: rotateBadge 3s linear infinite;
            }

            .expert-profile {
                width: 120px !important;
                height: 120px !important;
                margin-right: 30px !important;
            }

            .expert-name {
                font-size: 2.2rem;
                color: #222;
            }

            .expert-level-mark {
                right: -20px;
                top: 70px;
                font-size: 6.5rem;
            }

            .expert-footer {
                font-size: 0.8rem;
            }
        }
    </style>

    <script>
        window.expertCardList = [
            {
                level: "社區人氣王",
                name: "彭筠芮",
                phone: "0975-270745",
                line: "https://line.me/ti/p/N91wEAN_cG",
                license: "106年登字第323773號",
                company: "立辰開發股份有限公司",
                image: "https://www.dajuteam.com.tw/upload/sale/202411041501371.jpg",
                container: "#expert-container",
                start: "2025-08-01 00:00:00",
                end: "2025-08-30 00:00:00",
                styleClass: "expert-card-wrapper expert-style-a"
            },
            {
                level: "社區專家",
                name: "黃道威",
                phone: "0988123456",
                line: "https://line.me/ti/p/abc123",
                license: "104年登字第123456號",
                company: "敦璟開發股份有限公司",
                image: "https://www.dajuteam.com.tw/upload/sale/202410120024030.jpg",
                container: "#expert-container",
                start: "2025-08-01 00:00:00",
                end: "2025-08-30 00:00:00",
                styleClass: "expert-style-b"
            },
            {
                level: "社區大師",
                name: "鄭紘盛",
                phone: "0912123456",
                line: "https://line.me/ti/p/def456",
                license: "102年登字第654321號",
                company: "均富地產有限公司",
                image: "https://www.dajuteam.com.tw/upload/sale/202411141702211.jpg",
                container: "#expert-container",
                start: "2025-08-01 00:00:00",
                end: "2025-08-30 00:00:00",
                styleClass: "expert-style-c expert-card-wrapper-c"
            },
            {
                level: "社區專家",
                name: "劉芃谷",
                phone: "0988123456",
                line: "https://line.me/ti/p/abc123",
                license: "104年登字第123456號",
                company: "敦璟開發股份有限公司",
                image: "https://www.dajuteam.com.tw/upload/sale/202410120024221.jpg",
                container: "#expert-container",
                start: "2025-08-01 00:00:00",
                end: "2025-08-30 00:00:00",
                styleClass: "expert-style-d"
            }
        ];
    </script>

</head>

<body>

    <h2>雙橡園2279｜基本資料</h2>
    <ul>
        <li>建案位置：台中市西屯區馬龍潭路1、3號</li>
        <li>坐落地號：西屯區龍富段78地號</li>
        <li>建設公司：雙橡園建設</li>
        <li>基地面積：2279坪</li>
        <li>建築結構：SRC鋼骨鋼筋混凝土</li>
        <li>樓層高度：3.45米</li>
        <li>整體設計：地下3層、地上33層</li>
        <li>總體戶數：180戶</li>
        <li>戶梯配置：6戶4梯</li>
        <li>房型規劃：3房、4房</li>
        <li>車位數量：平車364個</li>
        <li>管理費用：待定</li>
        <li>公設配置：接待大廳、中庭花園、空中花園、閱覽室、健身房、親子遊戲區、信箱區、曬被區</li>
    </ul>

    <div id="expert-container">　</div>

    <h2>雙橡園2279｜環景空拍</h2>






    <!-- SCRIPT區域 -->


    <script>
        /**
         * Expert Card Injection System - 改進版本
         * 修正：錯誤處理、重複動畫類別、記憶體管理、瀏覽器兼容性
         */

        (function (window, document) {
            'use strict';

            if (window.ExpertCardSystem) return;

            const ExpertCardSystem = {
                // 儲存觀察者以便清理
                observers: [],

                LEVELS: {
                    "社區人氣王": {
                        icon: "fa-fire",
                        title: "【社區人氣王】",
                        mark: "HOT",
                        class: "expert-pop"
                    },
                    "社區專家": {
                        icon: "fa-trophy",
                        title: "【社區專家】",
                        mark: "PRO+",
                        class: "expert-pro"
                    },
                    "社區大師": {
                        icon: "fa-crown",
                        title: "【社區大師】",
                        mark: "MASTER",
                        class: "expert-master"
                    }
                },

                getTaiwanTime() {
                    try {
                        const now = new Date();
                        const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
                        return new Date(utc + (8 * 3600000));
                    } catch (error) {
                        console.warn('ExpertCard: 時間計算錯誤', error);
                        return new Date();
                    }
                },

                isInTimeRange(start, end) {
                    if (!start || !end) return true;
                    try {
                        const now = this.getTaiwanTime();
                        const parseDate = str => new Date(str.replace(/-/g, '/'));
                        const s = parseDate(start), e = parseDate(end);
                        return now >= s && now <= e;
                    } catch (error) {
                        console.warn('ExpertCard: 時間範圍檢查錯誤', error);
                        return true;
                    }
                },

                escapeHtml(str) {
                    if (!str) return '';
                    const div = document.createElement('div');
                    div.textContent = str;
                    return div.innerHTML;
                },

                generateCardHTML(opt) {
                    try {
                        // 檢查等級是否存在
                        const lvl = this.LEVELS[opt.level];
                        if (!lvl) {
                            console.warn('ExpertCard: 未知等級', opt.level);
                            return '';
                        }

                        const imageSrc = this.escapeHtml(opt.image);
                        const styleClass = this.escapeHtml(opt.styleClass || '');
                        return `
         <div class="expert-card-wrapper expert-platinum ${styleClass} animate__animated expert-card-hidden" data-animate="animate__flipInY">
  <div class="expert-card expert-platinum ${lvl.class}">
              <div class="expert-pin expert-pin-tl"></div>
              <div class="expert-pin expert-pin-tr"></div>
              <div class="expert-pin expert-pin-bl"></div>
              <div class="expert-pin expert-pin-br"></div>
              <div class="expert-badge"><i class="fas ${lvl.icon}"></i></div>
              <img alt="頭像" class="expert-profile" src="" data-src="${imageSrc}" loading="lazy" />
              <div class="expert-info">
                <div class="expert-title"><i class="fas ${lvl.icon}"></i>${lvl.title}</div>
                <div class="expert-name-row">
                  <div class="expert-name">${this.escapeHtml(opt.name)}</div>
                  <div class="expert-contact">
                    ${opt.phone ? `<a class="expert-contact-phone" href="tel:${this.escapeHtml(opt.phone)}">
                      <i class="fas fa-phone-alt"></i><span>${this.escapeHtml(opt.phone)}</span>
                    </a>` : ''}
                    ${opt.line ? `<a class="expert-contact-line" href="${this.escapeHtml(opt.line)}" target="_blank" rel="noopener">
                      <i class="fab fa-line"></i><span>LINE</span>
                    </a>` : ''}
                  </div>
                </div>
                <div class="expert-footer">證號：${this.escapeHtml(opt.license || '')}｜經紀業：${this.escapeHtml(opt.company || '')}</div>
                <div class="expert-level-mark">${lvl.mark}&nbsp;</div>
              </div>
            </div>
          </div>
        `;
                    } catch (error) {
                        console.error('ExpertCard: HTML生成失敗', error);
                        return '';
                    }
                },

                injectExpertCard(opt) {
                    try {
                        // 檢查配置完整性
                        if (!opt || !opt.container || !opt.level || !opt.name) {
                            console.warn('ExpertCard: 配置不完整', opt);
                            return false;
                        }

                        const container = document.querySelector(opt.container);
                        if (!container) {
                            console.warn('ExpertCard: 找不到容器', opt.container);
                            return false;
                        }

                        if (!this.isInTimeRange(opt.start, opt.end)) {
                            return false;
                        }

                        const html = this.generateCardHTML(opt);
                        if (html) {
                            container.insertAdjacentHTML('beforeend', html);
                            return true;
                        }
                        return false;
                    } catch (error) {
                        console.error('ExpertCard: 卡片注入失敗', error);
                        return false;
                    }
                },

                observeAnimations() {
                    // 檢查瀏覽器支援
                    if (!('IntersectionObserver' in window)) {
                        console.warn('ExpertCard: 瀏覽器不支援 IntersectionObserver');
                        // 降級處理：直接顯示所有卡片
                        const cards = document.querySelectorAll('.expert-card-hidden');
                        cards.forEach(card => {
                            card.classList.remove('expert-card-hidden');
                            card.classList.add('expert-card-fallback'); // 👈 新增這行
                        });
                        return;
                    }

                    const cards = document.querySelectorAll('.expert-card-wrapper[data-animate]:not(.expert-observed)');
                    if (cards.length === 0) return;

                    const observer = new IntersectionObserver(entries => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                const el = entry.target;
                                const anim = el.dataset.animate;

                                try {
                                    // 移除隱藏狀態
                                    el.classList.remove('expert-card-hidden');

                                    // 加入動畫（注意：不重複加入 animate__animated）
                                    if (!el.classList.contains('animate__animated')) {
                                        el.classList.add('animate__animated', anim);
                                        el.style.setProperty('--animate-duration', '1.5s');
                                    }

                                    observer.unobserve(el);
                                } catch (error) {
                                    console.error('ExpertCard: 動畫觸發失敗', error);
                                    // 至少確保顯示
                                    el.classList.remove('expert-card-hidden');
                                    observer.unobserve(el);
                                }
                            }
                        });
                    }, {
                        threshold: 0.3,
                        rootMargin: '20px'
                    });

                    // 標記已觀察，避免重複
                    cards.forEach(el => {
                        el.classList.add('expert-observed');
                        observer.observe(el);
                    });

                    // 儲存觀察者實例
                    this.observers.push(observer);
                },

                lazyLoadImages() {
                    // 檢查瀏覽器支援
                    if (!('IntersectionObserver' in window)) {
                        // 降級處理：直接載入所有圖片
                        const images = document.querySelectorAll('img[data-src]');
                        images.forEach(img => {
                            img.src = img.dataset.src;
                            img.removeAttribute('data-src');
                        });
                        return;
                    }

                    const images = document.querySelectorAll('img[data-src]:not(.expert-image-observed)');
                    if (images.length === 0) return;

                    const observer = new IntersectionObserver(entries => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                const img = entry.target;
                                try {
                                    img.src = img.dataset.src;
                                    img.removeAttribute('data-src');
                                    observer.unobserve(img);
                                } catch (error) {
                                    console.error('ExpertCard: 圖片載入失敗', error);
                                    observer.unobserve(img);
                                }
                            }
                        });
                    }, { rootMargin: "100px" });

                    // 標記已觀察，避免重複
                    images.forEach(img => {
                        img.classList.add('expert-image-observed');
                        observer.observe(img);
                    });

                    // 儲存觀察者實例
                    this.observers.push(observer);
                },

                // 清理資源的方法
                destroy() {
                    this.observers.forEach(observer => {
                        if (observer && typeof observer.disconnect === 'function') {
                            observer.disconnect();
                        }
                    });
                    this.observers = [];
                },

                init() {
                    try {
                        const list = window.expertCardList || [];
                        if (list.length === 0) {
                            console.warn('ExpertCard: 沒有找到 expertCardList');
                            return;
                        }

                        // 注入卡片
                        list.forEach(cfg => this.injectExpertCard(cfg));

                        // 初始化功能
                        this.lazyLoadImages();
                        this.observeAnimations();

                    } catch (error) {
                        console.error('ExpertCard: 初始化失敗', error);
                    }
                }
            };

            window.ExpertCardSystem = ExpertCardSystem;

            // 頁面卸載時清理資源
            window.addEventListener('beforeunload', () => {
                ExpertCardSystem.destroy();
            });

            // 自動初始化
            document.readyState === 'loading' ?
                document.addEventListener('DOMContentLoaded', () => ExpertCardSystem.init()) :
                ExpertCardSystem.init();

        })(window, document);

    </script>
</body>

</html>
